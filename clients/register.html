<!DOCTYPE html>
<html lang="ko">
  <head>
    <title>ğŸƒ ìœ ë ¹ ëŒ€ê¸°ì—´ ë“±ë¡</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />

    <style>
      @import url("https://fonts.googleapis.com/css2?family=Creepster&display=swap");

      body {
        /* ì–´ë‘¡ê³  ìŠ¤ì‚°í•œ ë°°ê²½ */
        background-color: #1a1a1a;
        color: #f0f0f0;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        padding: 20px;
        /* ë°°ê²½ íŒ¨í„´ ì¶”ê°€ */
        background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><circle cx="50" cy="50" r="10" fill="%23333333" opacity="0.1"/><circle cx="50" cy="50" r="20" fill="none" stroke="%23333333" stroke-width="1" opacity="0.05"/></svg>');
        background-size: 20px 20px;
      }

      /* Creepster í°íŠ¸ë¥¼ ì œëª©ì— ì‚¬ìš© */
      .spooky-font {
        font-family: "Creepster", cursive;
      }

      /* ì£¼í™©ìƒ‰ í…Œë§ˆ ìƒ‰ìƒ ì •ì˜ */
      .bg-halloween-orange {
        background-color: #ff7800;
      }
      .text-halloween-orange {
        color: #ff7800;
      }
      .hover\:bg-halloween-dark-orange:hover {
        background-color: #e66b00;
      }
      .focus\:ring-halloween-orange:focus {
        --tw-ring-color: #ff7800;
      }

      /* ë„¤ì˜¨ ê·¸ë¦° ì„±ê³µ ìƒ‰ìƒ ì •ì˜ */
      .bg-neon-green {
        background-color: #ccff00;
      }
      .text-neon-green {
        color: #ccff00;
      }

      /* í• ë¡œìœˆ ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
      .halloween-box {
        background-color: #333333; /* Darker grey for card */
        border: 3px solid #8a2be2; /* Purple border */
        box-shadow: 0 0 30px rgba(138, 43, 226, 0.5); /* Purple glow */
      }
    </style>
  </head>
  <body class="p-6 md:p-10">
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ["Inter", "sans-serif"],
              spooky: ["Creepster", "cursive"],
            },
            colors: {
              "halloween-orange": "#ff7800",
              "halloween-dark-orange": "#e66b00",
              "neon-green": "#ccff00",
              "spooky-purple": "#8a2be2",
              "spooky-red": "#6a0505",
            },
          },
        },
      };
    </script>

    <div
      class="halloween-box p-8 md:p-10 rounded-3xl shadow-2xl max-w-sm w-full text-center transform transition duration-500 hover:scale-[1.02]"
    >
      <h1
        class="text-4xl md:text-5xl font-extrabold text-halloween-orange mb-6 spooky-font flex items-center justify-center gap-3"
      >
        <i class="fas fa-ghost text-spooky-purple"></i> ìœ ë ¹ ë“±ë¡ë¶€
        <i class="fas fa-pumpkin text-halloween-orange"></i>
      </h1>

      <form id="register-form" class="flex flex-col gap-4">
        <div>
          <label
            for="name"
            class="block text-left text-neon-green font-bold mb-2 text-lg"
          >
            <i class="fas fa-user-secret"></i> ì´ë¦„:
          </label>
          <input
            type="text"
            id="name"
            name="name"
            required
            class="w-full p-4 rounded-xl bg-gray-600 text-white placeholder-gray-400 border border-spooky-purple focus:outline-none focus:ring-4 focus:ring-spooky-purple transition-shadow"
            placeholder="ìœ¼ìŠ¤ìŠ¤í•œ ì´ë¦„"
          />
        </div>
        <div>
          <label
            for="phone_number"
            class="block text-left text-neon-green font-bold mb-2 text-lg"
          >
            <i class="fas fa-magic"></i> ì „í™”ë²ˆí˜¸:
          </label>
          <input
            type="tel"
            id="phone_number"
            name="phone_number"
            required
            pattern="[0-9]{11}"
            maxlength="11"
            class="w-full p-4 rounded-xl bg-gray-600 text-white placeholder-gray-400 border border-spooky-purple focus:outline-none focus:ring-4 focus:ring-spooky-purple transition-shadow"
            placeholder="01012345678 (ìˆ«ì 11ìë¦¬)"
            title="ì „í™”ë²ˆí˜¸ëŠ” ìˆ«ì 11ìë¦¬ë§Œ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤. (ì˜ˆ: 01012345678)"
          />
        </div>
        <button
          type="submit"
          id="register-button"
          class="w-full mt-6 p-4 rounded-3xl bg-halloween-orange text-gray-900 font-extrabold text-xl hover:bg-halloween-dark-orange transform hover:scale-[1.05] transition-all shadow-lg"
        >
          <i class="fas fa-hat-wizard"></i> ë“±ë¡í•˜ê³  ëŒ€ê¸°í•˜ê¸°
        </button>
      </form>

      <p
        id="status-message"
        class="mt-6 p-3 rounded-xl font-bold text-lg transition-colors min-h-12"
      ></p>
    </div>

    <script>
      const registerForm = document.getElementById("register-form");
      const statusMessage = document.getElementById("status-message");
      const phoneNumberInput = document.getElementById("phone_number"); // ìƒˆë¡œ ì¶”ê°€

      // API BASE URLì„ ë™ì ìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.
      const API_BASE_URL =
        window.location.protocol + "//" + window.location.host + "/api/v1";

      registerForm.addEventListener("submit", async (event) => {
        event.preventDefault(); // ê¸°ë³¸ í¼ ì œì¶œ ë°©ì§€

        // ë¸Œë¼ìš°ì € ê¸°ë³¸ ìœ íš¨ì„± ê²€ì‚¬ (required, pattern)ë¥¼ í†µê³¼í–ˆëŠ”ì§€ ë‹¤ì‹œ í™•ì¸
        if (!registerForm.checkValidity()) {
          // ë¸Œë¼ìš°ì €ê°€ ê¸°ë³¸ ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ í‘œì‹œí•˜ë¯€ë¡œ ë³„ë„ì˜ ë©”ì‹œì§€ëŠ” í•„ìš” ì—†ì„ ìˆ˜ ìˆìœ¼ë‚˜,
          // ì‚¬ìš©ì ì •ì˜ ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ í‘œì‹œí•˜ê³  ì‹¶ë‹¤ë©´ ì•„ë˜ ì½”ë“œë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
          // showError('ğŸ’€ ì „í™”ë²ˆí˜¸ê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. (ìˆ«ì 11ìë¦¬)');
          return;
        }

        const name = document.getElementById("name").value;
        // ì „í™”ë²ˆí˜¸ì—ì„œ ìˆ«ìê°€ ì•„ë‹Œ ëª¨ë“  ë¬¸ì ì œê±°
        const rawPhoneNumber = phoneNumberInput.value.replace(/[^0-9]/g, "");
        const phoneNumber = rawPhoneNumber; // ì´ë¯¸ pattern="[0-9]{11}"ë¡œ ìˆ«ì 11ìë¦¬ë§Œ ë“¤ì–´ì˜¤ê²Œ ì œí•œë¨

        // âœ… JSì—ì„œ í•œ ë²ˆ ë” ê¸¸ì´ ì²´í¬ (ì´ì¤‘ í™•ì¸)
        if (phoneNumber.length !== 11) {
          statusMessage.textContent =
            "ğŸ’€ ë“±ë¡ ì‹¤íŒ¨: ì „í™”ë²ˆí˜¸ëŠ” ì •í™•íˆ ìˆ«ì 11ìë¦¬ì—¬ì•¼ í•©ë‹ˆë‹¤.";
          statusMessage.className =
            "mt-6 p-3 rounded-xl font-extrabold text-lg bg-spooky-red text-white transition-colors shadow-lg shadow-spooky-red/50 min-h-12";
          return; // ê¸¸ì´ê°€ ë§ì§€ ì•Šìœ¼ë©´ ë“±ë¡ì„ ë§‰ìŒ
        }

        // ë©”ì‹œì§€ ì´ˆê¸°í™” ë° ë¡œë”© í‘œì‹œ
        statusMessage.textContent = "ë“±ë¡ ë§ˆë²•ì„ ì‹œì „ ì¤‘...";
        statusMessage.className =
          "mt-6 p-3 rounded-xl font-bold text-lg bg-gray-600 text-white transition-colors min-h-12";

        try {
          const response = await fetch(API_BASE_URL + "/queue/register", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ name: name, phone_number: phoneNumber }),
          });

          const data = await response.json();

          if (response.ok) {
            // ì„±ê³µ ì‹œ: ë„¤ì˜¨ ê·¸ë¦° ë°°ê²½, ì–´ë‘ìš´ í…ìŠ¤íŠ¸
            statusMessage.textContent = `âœ¨ ë“±ë¡ ì™„ë£Œ! ëŒ€ê¸°ë²ˆí˜¸: ${data.id}, ì´ë¦„: ${data.name}`;
            statusMessage.className =
              "mt-6 p-3 rounded-xl font-extrabold text-lg bg-neon-green text-gray-900 transition-colors shadow-lg shadow-neon-green/50 min-h-12";
            registerForm.reset();
          } else {
            // ì‹¤íŒ¨ ì‹œ: ìœ¼ìŠ¤ìŠ¤í•œ ë¹¨ê°„ìƒ‰ ë°°ê²½, í°ìƒ‰ í…ìŠ¤íŠ¸
            statusMessage.textContent = `ğŸ’€ ë“±ë¡ ì‹¤íŒ¨: ${
              data.detail || "ì•Œ ìˆ˜ ì—†ëŠ” ì €ì£¼"
            }`;
            statusMessage.className =
              "mt-6 p-3 rounded-xl font-extrabold text-lg bg-spooky-red text-white transition-colors shadow-lg shadow-spooky-red/50 min-h-12";
          }
        } catch (error) {
          // ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ì‹œ: ìœ¼ìŠ¤ìŠ¤í•œ ë¹¨ê°„ìƒ‰ ë°°ê²½
          statusMessage.textContent =
            "ğŸ‘» ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë§ˆë²•ì§„ì´ ëŠì–´ì¡ŒìŠµë‹ˆë‹¤.";
          statusMessage.className =
            "mt-6 p-3 rounded-xl font-extrabold text-lg bg-spooky-red text-white transition-colors shadow-lg shadow-spooky-red/50 min-h-12";
          console.error("Error:", error);
        }
      });
    </script>
  </body>
</html>
